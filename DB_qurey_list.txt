create database dbwte;
USE dbwte; 

create table users (
id int PRIMARY KEY AUTO_INCREMENT,
uname varchar(255) unique not null,
upw_hash varchar(255) not null,
ubirth date not null,
uemail varchar(50) unique not null,
unick varchar(50) unique not null,
register timestamp DEFAULT CURRENT_TIMESTAMP,
reg_update timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

create table user_profiles (
user_id int PRIMARY KEY,
profile_img blob,
FOREIGN KEY (user_id) REFERENCES users(id)
);

--users : user_profiles = 1:1

create table roles (
id int PRIMARY KEY AUTO_INCREMENT,
role1 varchar(50) not null
);

create table user_roles (
user_id int not null,
role_id int not null,
PRIMARY KEY (user_id, role_id),
FOREIGN KEY (user_id) REFERENCES users(id),
FOREIGN KEY (role_id) REFERENCES roles(id)
);


create table social_login (
user_id int PRIMARY KEY unique not null,
provider varchar(50) not null,
provider_user_id varchar(255) not null,
created_at timestamp DEFAULT CURRENT_TIMESTAMP,
FOREIGN KEY (user_id) REFERENCES users(id),
UNIQUE (provider, provider_user_id)
);

create table user_health (
user_id int PRIMARY KEY,
sex tinyint(1) not null,
age int not null,
height int not null,
weight int not null,
activity varchar(10) not null,
disease varchar(255),
mens date,
eattpye varchar(20) not null,
eatpattern varchar(20) not null,
others varchar(255),
FOREIGN KEY (user_id) REFERENCES users(id)
);

create table user_taste (
user_id int PRIMARY KEY,
food_category text,
food_strongly_like text,
food_like text,
food_neutral text,
food_dislike text,
food_strongly_dislike text,
prefer_recipe text,
avoid_foodstuff text,
prefer_foodstuff text,
sweet int,
salty int,
spicy int,
sour int,
umami int,
savory int,
plain int,
oily int,
FOREIGN KEY (user_id) REFERENCES users(id)
);

create table food_data (
id int PRIMARY KEY AUTO_INCREMENT,
food varchar(100) unique not null,
level1 varchar(50) not null,
level2 varchar(50) not null,
keyword text not null,
foodstuff text not null,
allergy text not null
);

CREATE TABLE user_preferences (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    food_id int NOT NULL,
    good_point INT NOT NULL,
    last_ate timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    rec_good boolean,
    rec_bed boolean,
    hide boolean,
    FOREIGN KEY (user_id) REFERENCES users(id),
   FOREIGN KEY (food_id) REFERENCES food_data(id)
);

create table notice (
id int PRIMARY KEY AUTO_INCREMENT,
title varchar(50) not null,
content text not null,
register timestamp DEFAULT CURRENT_TIMESTAMP,
reg_update timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

create table ask (
id int PRIMARY KEY AUTO_INCREMENT,
title varchar(50) not null,
content text not null,
register timestamp DEFAULT CURRENT_TIMESTAMP,
status ENUM('안읽음', '확인중', '답변완료') DEFAULT '안읽음'
);

CREATE TABLE search_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    query VARCHAR(255) NOT NULL,
    search_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
--세션에 먼저 저장하고 밤12시되면 땅 하고 디비에 저장됫으면조켓네..

create table keyword_rec (
   id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    good_keyword varchar(255),
    hate_keyword varchar(255),
    search_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
--세션에 먼저 저장하고 밤12시되면 땅 하고 디비에 저장됫으면조켓네..

create table keyword_rand (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    good_keyword varchar(255),
    hate_keyword varchar(255),
    search_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
--세션에 먼저 저장하고 밤12시되면 땅 하고 디비에 저장됫으면조켓네..

create table keyword_friend (
   id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    good_keyword varchar(255),
    hate_keyword varchar(255),
    search_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
--세션에 먼저 저장하고 밤12시되면 땅 하고 디비에 저장됫으면조켓네..

create table keyword_diet (
   id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    good_keyword varchar(255),
    hate_keyword varchar(255),
    search_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE diet (
   id int NOT NULL AUTO_INCREMENT,
   user_id int DEFAULT NULL,
   weight int DEFAULT NULL,
   goal_weight int DEFAULT NULL,
   skeletal int DEFAULT NULL, 골격근량
   fatmass int DEFAULT NULL, 체지방량
   goal_day date DEFAULT NULL, 목표 무게
   eating varchar(255) DEFAULT NULL, 지금먹은거
   kcal int DEFAULT NULL, 지금먹은거 칼로리
   register timestamp NULL DEFAULT CURRENT_TIMESTAMP,
   PRIMARY KEY (id),
   FOREIGN KEY (user_id) REFERENCES users(id)
 )
--세션에 먼저 저장하고 밤12시되면 땅 하고 디비에 저장됫으면조켓네..

create table setting (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    pushalarm boolean not null DEFAULT 1,
    darkORwhite ENUM('시스템설정', '화이트모드', '다크모드') DEFAULT '시스템설정',
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE user_log (
    log_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    event_type VARCHAR(50) NOT NULL,
    event_detail TEXT,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    ip_address VARCHAR(45),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
